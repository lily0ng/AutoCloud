# Custom SQL Injection Protection Rules
# Enhanced detection beyond OWASP CRS

SecRule ARGS "@detectSQLi" \
    "id:10000,\
    phase:2,\
    block,\
    log,\
    msg:'SQL Injection Attack Detected',\
    severity:CRITICAL,\
    tag:'application-multi',\
    tag:'language-multi',\
    tag:'platform-multi',\
    tag:'attack-sqli',\
    setvar:'tx.sql_injection_score=+%{tx.critical_anomaly_score}',\
    setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}'"

SecRule ARGS "@rx (?i:(\bselect\b.+\bfrom\b|\bunion\b.+\bselect\b|\binsert\b.+\binto\b|\bupdate\b.+\bset\b|\bdelete\b.+\bfrom\b))" \
    "id:10001,\
    phase:2,\
    block,\
    log,\
    msg:'SQL Injection - Common SQL Keywords',\
    severity:CRITICAL,\
    setvar:'tx.sql_injection_score=+5'"

SecRule ARGS "@rx (?i:(exec(\s|\+)+(s|x)p\w+))" \
    "id:10002,\
    phase:2,\
    block,\
    log,\
    msg:'SQL Injection - Stored Procedure Execution',\
    severity:CRITICAL"

SecRule ARGS "@rx (?i:(\bor\b\s+\d+\s*=\s*\d+|\band\b\s+\d+\s*=\s*\d+))" \
    "id:10003,\
    phase:2,\
    block,\
    log,\
    msg:'SQL Injection - Tautology Attack',\
    severity:CRITICAL"
