# Custom Remote Code Execution Protection Rules
# Command injection and RCE detection

SecRule ARGS "@rx (?i:(\||;|`|\$\(|\$\{|<\(|>\())" \
    "id:12000,\
    phase:2,\
    block,\
    log,\
    msg:'Command Injection - Shell Metacharacters',\
    severity:CRITICAL,\
    tag:'attack-rce'"

SecRule ARGS "@rx (?i:(bash|sh|cmd|powershell|perl|python|ruby|php)\s)" \
    "id:12001,\
    phase:2,\
    block,\
    log,\
    msg:'Command Injection - Shell Execution',\
    severity:CRITICAL"

SecRule ARGS "@rx (?i:(wget|curl|nc|netcat|telnet|ssh|ftp))" \
    "id:12002,\
    phase:2,\
    block,\
    log,\
    msg:'Command Injection - Network Tools',\
    severity:CRITICAL"

SecRule ARGS "@rx (?i:(eval|exec|system|passthru|shell_exec|popen|proc_open)\s*\()" \
    "id:12003,\
    phase:2,\
    block,\
    log,\
    msg:'RCE - Dangerous PHP Functions',\
    severity:CRITICAL"
