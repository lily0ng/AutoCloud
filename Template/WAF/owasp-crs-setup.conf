# OWASP CRS v4.0 Setup Configuration
# Customize OWASP Core Rule Set behavior

# -- Paranoia Level ----------------------------------------------------------
# The Paranoia Level (PL) setting allows you to choose the desired level
# of rule checks that will add to your anomaly scores.
#
# Paranoia Levels:
# 1 - Default level, recommended for most sites
# 2 - Higher security, more false positives
# 3 - Even higher security, even more false positives
# 4 - Maximum security, highest false positive rate
#
SecAction \
  "id:900000,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.blocking_paranoia_level=2"

# -- Executing Paranoia Level ------------------------------------------------
SecAction \
  "id:900001,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.executing_paranoia_level=2"

# -- Anomaly Scoring ---------------------------------------------------------
# Inbound Anomaly Score Threshold
SecAction \
  "id:900110,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.inbound_anomaly_score_threshold=5"

# Outbound Anomaly Score Threshold
SecAction \
  "id:900111,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.outbound_anomaly_score_threshold=4"

# -- Sampling Percentage -----------------------------------------------------
SecAction \
  "id:900400,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.sampling_percentage=100"

# -- Application Defenses ----------------------------------------------------
# HTTP Policy Settings
SecAction \
  "id:900200,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.allowed_methods=GET HEAD POST OPTIONS PUT PATCH DELETE"

SecAction \
  "id:900201,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.allowed_request_content_type=|application/x-www-form-urlencoded| |multipart/form-data| |multipart/related| |text/xml| |application/xml| |application/soap+xml| |application/json| |application/cloudevents+json| |application/cloudevents-batch+json|"

SecAction \
  "id:900202,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.allowed_http_versions=HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0 HTTP/3 HTTP/3.0"

# Restricted File Extensions
SecAction \
  "id:900220,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .rdb/ .resources/ .resx/ .sql/ .swp/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/'"

# Restricted File Upload Extensions
SecAction \
  "id:900221,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:'tx.restricted_upload_extensions=.asa/ .asax/ .ascx/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .exe/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .rdb/ .resources/ .resx/ .sql/ .swp/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/'"

# -- HTTP Argument/Parameter Limits ------------------------------------------
SecAction \
  "id:900300,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.max_num_args=255"

SecAction \
  "id:900301,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.arg_name_length=100"

SecAction \
  "id:900302,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.arg_length=400"

SecAction \
  "id:900303,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.total_arg_length=64000"

# -- File Upload Limits ------------------------------------------------------
SecAction \
  "id:900320,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.max_file_size=1048576"

SecAction \
  "id:900321,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.combined_file_sizes=1048576"

# -- Blocking Evaluation -----------------------------------------------------
SecAction \
  "id:900500,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.blocking_early=0"

# -- GeoIP Database ----------------------------------------------------------
SecGeoLookupDB /usr/share/GeoIP/GeoLite2-Country.mmdb

# -- Project Honeypot HTTP Blacklist -----------------------------------------
SecAction \
  "id:900600,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.block_search_ip=0"

SecAction \
  "id:900601,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.block_suspicious_ip=0"

SecAction \
  "id:900602,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.block_harvester_ip=0"

SecAction \
  "id:900603,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.block_spammer_ip=0"
