# Custom Geo-Blocking Rules
# Country-based access control

# Block specific countries (example: CN, RU, KP)
SecRule REMOTE_ADDR "@geoLookup" \
    "id:15000,\
    phase:1,\
    chain,\
    drop,\
    log,\
    msg:'Access denied - Blocked country'"
    SecRule GEO:COUNTRY_CODE "@rx ^(CN|RU|KP|IR|SY)$" \
        "t:none"

# Allow only specific countries (whitelist approach)
# SecRule REMOTE_ADDR "@geoLookup" \
#     "id:15001,\
#     phase:1,\
#     chain,\
#     drop,\
#     log,\
#     msg:'Access denied - Country not in whitelist'"
#     SecRule GEO:COUNTRY_CODE "!@rx ^(US|CA|GB|DE|FR|AU)$" \
#         "t:none"

# Block specific regions for sensitive endpoints
SecRule REQUEST_URI "@beginsWith /admin" \
    "id:15002,\
    phase:1,\
    chain,\
    deny,\
    status:403,\
    log,\
    msg:'Admin access blocked from restricted country'"
    SecRule REMOTE_ADDR "@geoLookup" \
        "chain"
    SecRule GEO:COUNTRY_CODE "@rx ^(CN|RU|KP)$" \
        "t:none"

# Log access from high-risk countries
SecRule REMOTE_ADDR "@geoLookup" \
    "id:15003,\
    phase:1,\
    pass,\
    log,\
    msg:'Access from high-risk country: %{GEO:COUNTRY_CODE}',\
    chain"
    SecRule GEO:COUNTRY_CODE "@rx ^(CN|RU|KP|IR|SY|VN|BR)$" \
        "t:none"
