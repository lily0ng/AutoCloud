AWSTemplateFormatVersion: '2010-09-09'
Description: 'Amazon Athena WorkGroup Template'

Parameters:
  WorkGroupName:
    Type: String
    Default: MyAthenaWorkGroup

Resources:
  ResultsBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${WorkGroupName}-results-${AWS::AccountId}'
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256

  AthenaWorkGroup:
    Type: AWS::Athena::WorkGroup
    Properties:
      Name: !Ref WorkGroupName
      Description: Athena WorkGroup
      State: ENABLED
      WorkGroupConfiguration:
        ResultConfiguration:
          OutputLocation: !Sub 's3://${ResultsBucket}/results/'
          EncryptionConfiguration:
            EncryptionOption: SSE_S3
        EnforceWorkGroupConfiguration: true
        PublishCloudWatchMetricsEnabled: true

Outputs:
  WorkGroupName:
    Value: !Ref AthenaWorkGroup
  ResultsBucketName:
    Value: !Ref ResultsBucket
