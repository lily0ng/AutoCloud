# FreeBSD Apache Configuration

# Port Configuration
Listen 80
Listen 443
Listen 8080
Listen 8443
Listen 3000

# Load Required Modules
LoadModule proxy_module libexec/apache24/mod_proxy.so
LoadModule proxy_http_module libexec/apache24/mod_proxy_http.so
LoadModule ssl_module libexec/apache24/mod_ssl.so

# Proxy Configuration
<IfModule mod_proxy.c>
    ProxyRequests Off
    ProxyPreserveHost On

    # Security Settings
    <Proxy *>
        Require all granted
    </Proxy>

    # Application Proxies
    ProxyPass /app1 http://localhost:3000
    ProxyPassReverse /app1 http://localhost:3000

    ProxyPass /api http://localhost:8080/api
    ProxyPassReverse /api http://localhost:8080/api

    # SSL Configuration
    <VirtualHost *:443>
        SSLEngine on
        SSLCertificateFile "/usr/local/etc/apache24/server.crt"
        SSLCertificateKeyFile "/usr/local/etc/apache24/server.key"
        
        ProxyPass /secure https://localhost:8443
        ProxyPassReverse /secure https://localhost:8443
    </VirtualHost>

    # Load Balancer Configuration
    <Proxy "balancer://mycluster">
        BalancerMember "http://localhost:8081"
        BalancerMember "http://localhost:8082"
        ProxySet lbmethod=byrequests
    </Proxy>

    # Error Documents
    ErrorDocument 500 /custom_error.html
    ErrorDocument 502 /custom_error.html
    ErrorDocument 503 /custom_error.html
    ErrorDocument 504 /custom_error.html
</IfModule>
