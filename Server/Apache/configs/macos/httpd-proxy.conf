# macOS Apache Configuration

# Port Configuration
Listen 80
Listen 443
Listen 8080
Listen 8443
Listen 3000

# Load Required Modules
LoadModule proxy_module libexec/apache2/mod_proxy.so
LoadModule proxy_http_module libexec/apache2/mod_proxy_http.so
LoadModule ssl_module libexec/apache2/mod_ssl.so

# Proxy Configuration
<IfModule mod_proxy.c>
    ProxyRequests Off
    ProxyPreserveHost On

    # Security Configuration
    <Proxy *>
        Require all granted
    </Proxy>

    # Application Proxies
    ProxyPass /app1 http://localhost:3000
    ProxyPassReverse /app1 http://localhost:3000

    ProxyPass /api http://localhost:8080/api
    ProxyPassReverse /api http://localhost:8080/api

    # SSL Proxy Configuration
    <VirtualHost *:443>
        SSLEngine on
        SSLCertificateFile "/private/etc/apache2/server.crt"
        SSLCertificateKeyFile "/private/etc/apache2/server.key"
        
        ProxyPass /secure https://localhost:8443
        ProxyPassReverse /secure https://localhost:8443
    </VirtualHost>

    # Load Balancing Configuration
    <Proxy "balancer://mycluster">
        BalancerMember "http://localhost:8081"
        BalancerMember "http://localhost:8082"
        ProxySet lbmethod=byrequests
    </Proxy>

    # Timeout Settings
    ProxyTimeout 300
    ProxyBadHeader Ignore
</IfModule>
