package main

import (
	"fmt"
	"log"
)

type Vulnerability struct {
	ID       string
	Severity string
	Title    string
	Resource string
	Fix      string
}

type VulnerabilityScanner struct {
	findings []Vulnerability
}

func NewVulnerabilityScanner() *VulnerabilityScanner {
	return &VulnerabilityScanner{
		findings: make([]Vulnerability, 0),
	}
}

func (vs *VulnerabilityScanner) ScanInfrastructure() {
	log.Println("üîç Scanning infrastructure for vulnerabilities...")
	
	vs.scanNetworkSecurity()
	vs.scanApplicationSecurity()
	vs.scanDatabaseSecurity()
	vs.scanContainerSecurity()
}

func (vs *VulnerabilityScanner) scanNetworkSecurity() {
	vs.findings = append(vs.findings, Vulnerability{
		ID:       "NET-001",
		Severity: "HIGH",
		Title:    "Open SSH port to 0.0.0.0/0",
		Resource: "Security Group sg-12345",
		Fix:      "Restrict SSH access to specific IP ranges",
	})
}

func (vs *VulnerabilityScanner) scanApplicationSecurity() {
	vs.findings = append(vs.findings, Vulnerability{
		ID:       "APP-001",
		Severity: "MEDIUM",
		Title:    "Outdated dependency detected",
		Resource: "package.json",
		Fix:      "Update lodash to version 4.17.21",
	})
}

func (vs *VulnerabilityScanner) scanDatabaseSecurity() {
	vs.findings = append(vs.findings, Vulnerability{
		ID:       "DB-001",
		Severity: "CRITICAL",
		Title:    "Database publicly accessible",
		Resource: "RDS Instance db-prod",
		Fix:      "Enable VPC and disable public access",
	})
}

func (vs *VulnerabilityScanner) scanContainerSecurity() {
	vs.findings = append(vs.findings, Vulnerability{
		ID:       "CON-001",
		Severity: "HIGH",
		Title:    "Container running as root",
		Resource: "Dockerfile",
		Fix:      "Use non-root user in container",
	})
}

func (vs *VulnerabilityScanner) GenerateReport() {
	fmt.Println("\nüîí Vulnerability Scan Report")
	fmt.Println("============================")
	
	critical := 0
	high := 0
	medium := 0
	low := 0
	
	for _, vuln := range vs.findings {
		switch vuln.Severity {
		case "CRITICAL":
			critical++
		case "HIGH":
			high++
		case "MEDIUM":
			medium++
		case "LOW":
			low++
		}
		
		fmt.Printf("\n[%s] %s\n", vuln.Severity, vuln.ID)
		fmt.Printf("  Title: %s\n", vuln.Title)
		fmt.Printf("  Resource: %s\n", vuln.Resource)
		fmt.Printf("  Fix: %s\n", vuln.Fix)
	}
	
	fmt.Printf("\nSummary:\n")
	fmt.Printf("  Critical: %d\n", critical)
	fmt.Printf("  High: %d\n", high)
	fmt.Printf("  Medium: %d\n", medium)
	fmt.Printf("  Low: %d\n", low)
}

func main() {
	scanner := NewVulnerabilityScanner()
	scanner.ScanInfrastructure()
	scanner.GenerateReport()
}
